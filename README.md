# interview

1. 数据库
    [文章表]主要字段：文章id，总阅读数(total_views)，用户访问人次(uv)，其他字段
    [用户阅读记录表]主要字段: 用户ip，用户阅读数(pv)，关联文章id
    
2. 路由
    文章详情页带文章id路由到指定详情页视图
    
3. 视图
    3.1 判断是否有文章id
    3.2 根据用户ip分别从redis获取相应的total_views、uv、pv缓存，如果没有缓存，则从数据库读取
    3.3 写redis缓存
        如果缓存存在，则直接操作redis做total_views和pv数+1，uv是做set集合(跟用户ip相关)
        如果缓存不存在，则先读取数据库数值，然后再操作redis+1，uv不存在，需要将[用户阅读记录表]的ip过滤去重再存进缓存
    3.4 异步存数据: 
        3.4.1 使用celery异步操作
        3.4.2 获取缓存数据，操作写入数据库，写入成功后刷一次缓存，保证一致性
              如果数据库异常，则回写一份数据到缓存中，数据库异常降级处理
    3.5 返回json数据到前端 